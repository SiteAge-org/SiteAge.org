---
import { formatAge, birthYear } from "@siteage/shared";
import type { DomainDetail } from "@siteage/shared";

interface Props {
  data: DomainDetail;
}

const { data } = Astro.props;
const birth = data.verified_birth_at || data.birth_at;
const isVerified = data.verification_status === "verified";
const catalogedDate = new Date(data.created_at).toLocaleDateString("en-US", { year: "numeric", month: "long", day: "numeric", timeZone: "UTC" });
---

<div id="certificate" class="relative bg-gradient-to-b from-white to-parchment/80 border border-divider p-10 sm:p-14 max-w-2xl mx-auto overflow-hidden noise-overlay shadow-[var(--shadow-certificate)]">
  <!-- Double-layer corner ornaments -->
  <div class="absolute top-3 left-3 w-12 h-12 border-t-2 border-l-2 border-seal/30"></div>
  <div class="absolute top-5 left-5 w-4 h-4 border-t border-l border-seal/15"></div>
  <div class="absolute top-3 right-3 w-12 h-12 border-t-2 border-r-2 border-seal/30"></div>
  <div class="absolute top-5 right-5 w-4 h-4 border-t border-r border-seal/15"></div>
  <div class="absolute bottom-3 left-3 w-12 h-12 border-b-2 border-l-2 border-seal/30"></div>
  <div class="absolute bottom-5 left-5 w-4 h-4 border-b border-l border-seal/15"></div>
  <div class="absolute bottom-3 right-3 w-12 h-12 border-b-2 border-r-2 border-seal/30"></div>
  <div class="absolute bottom-5 right-5 w-4 h-4 border-b border-r border-seal/15"></div>

  <!-- Inner decorative border -->
  <div class="absolute inset-6 border border-divider/50 pointer-events-none"></div>

  <div class="relative text-center">
    <!-- Header -->
    <div class="mb-8">
      <p class="text-[10px] tracking-[0.4em] uppercase text-seal-dark font-medium mb-2">Certificate of Website Longevity</p>
      <div class="ornament-line max-w-48 mx-auto"></div>
    </div>

    <!-- Domain -->
    <h1 class="font-display text-3xl sm:text-4xl mb-3 text-ink">{data.domain}</h1>

    <!-- Verification seal -->
    {isVerified && (
      <div class="inline-flex items-center gap-1.5 px-3 py-1 bg-gradient-to-r from-seal-light/20 to-seal/10 border border-seal/30 text-seal-dark text-xs tracking-[0.15em] uppercase font-medium mb-4">
        <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
        </svg>
        Verified Owner
      </div>
    )}

    <!-- Birth date -->
    {birth ? (
      <div class="my-8">
        <p class="text-xs tracking-[0.2em] uppercase text-ink-muted mb-2">{isVerified ? "Established" : "Online Since"}</p>
        <div class="relative inline-block">
          <!-- Blurred gold glow behind year -->
          <span class="absolute inset-0 bg-seal/[0.06] blur-xl rounded-full scale-150 pointer-events-none"></span>
          <p class="relative font-display text-6xl sm:text-7xl text-ink leading-none">{birthYear(birth)}</p>
        </div>
        <p class="text-sm text-ink-muted mt-3 font-light">{new Date(birth).toLocaleDateString("en-US", { year: "numeric", month: "long", day: "numeric" })}</p>
      </div>
    ) : (
      <div class="my-8">
        <p class="font-display text-3xl text-ink-muted">Birth Date Unknown</p>
      </div>
    )}

    <!-- Age -->
    {birth && (
      <div class="mb-8">
        <div class="ornament-line max-w-32 mx-auto mb-4"></div>
        <p class="text-ink-muted">
          Age: <span class="font-medium text-ink">{formatAge(birth)}</span>
        </p>
      </div>
    )}

    <!-- Footer -->
    <div class="pt-6">
      <div class="ornament-line mb-4"></div>
      <p class="text-[10px] text-ink-muted/70 tracking-[0.15em] uppercase mb-2">Cataloged on {catalogedDate}</p>
      <p class="text-[10px] text-ink-muted/50 tracking-[0.15em] uppercase">Certified by SiteAge.org &middot; Data from Internet Archive</p>
    </div>
  </div>
</div>
